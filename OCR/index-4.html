<!DOCTYPE html>
<html>

<head>
    <meta charset='UTF-8'>
    <!-- <script src="https://code.jquery.com/jquery-1.12.3.min.js"></script> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <style>
    body {
        margin: 0;
        padding: 0;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 3.4em;
    }
    
    ul {
        list-style-type: none;
        padding: 0;
        margin: 0;
    }
    
    ul li {
        border-top: 1px solid black;
        /*padding-top: 30px;*/
    }
    
    div {
        margin: 0px;
        padding: 0px;
    }
    
    #menu {
        position: absolute;
        background-color: #ffffff;
        width: 100%;
        height: 100%;
        margin: auto;
    }
    
    #Books {
        margin: 0;
        padding: 0;
    }
    
    .book {
        margin: 0px;
        padding: 0px;
        width: 100%;
    }
    
    .list {
        border-top: 1px solid black;
        background-color: #ffffff;
        color: #000000;
        padding: .5em 0 .5em 0;
    }
    
    .selected .book-title { /* for book titles that are selected */
        background-color: #000000;
        color: #ffffff;
    }
    
    .chapter {
        width: 100%;
        padding: 0;
        display: none;
    }
    
    .text-list {
        margin: 0;
        padding: 0;
        width: 100%;
        display: none;
    }
    
    .hide {
        display: none;
    }
    
    .show {
        display: inline-block;
    }

    .chapter.selected .text-list { /* the list of pages inside a selected chapter */
        display: inline-block;
    }
    
    .chapter.selected .book-text { /* the individual pages inside a selected chapter */
        white-space: nowrap;
        overflow: hidden;
        /* "overflow" value must be different from "visible" */
        text-overflow: ellipsis;
    }

    .selected .chapter-title {
        background-color: #e0e0e0;
    }
    
    .chapter.selected .book-text.selected { /*the selected individual page inside a selected chapter */
        white-space: normal;
        overflow: visible;
    }
    
    .caret-back {
        position: relative;
        color: #ffffff;
    }
    
    .breadcrumb-icon {
        display: none;
    }

    .opacity {
        opacity: 0.4;
    }
    
    .selected .breadcrumb-icon { /* A breadcrumb icon inside a selected element */
        display: inline-block;
    }
    
    .book.selected .chapter { /* for book titles that are selected */
        display: inline-block;
    }

    </style>
</head>

<body>
    <!-- <header>
        <h1>My App</h1>
    </header> -->
    <div id="menu">
        <ul id="Books">
        </ul>
    </div>
    <script>
    var bookData = {
        'id11111': {
            "Alice's Adventures in Wonderland": {
                "Chapter 1 - Down the Rabbit-Hole": [
                    "Alice was beginning to get very tired of sitting by her sister on the bank, and of having nothing to do: once or twice she had peeped into the book her sister was reading, but it had no pictures or conversations in it, `and what is the use of a book,' thought Alice `without pictures or conversation?'",
                    "So she was considering in her own mind (as well as she could, for the hot day made her feel very sleepy and stupid), whether the pleasure of making a daisy- chain would be worth the trouble of getting up and picking the daisies, when suddenly a White Rabbit with pink eyes ran close by her.",
                    "There was nothing so very remarkable in that; nor did Alice think it so very much out of the way to hear the Rabbit say to itself, `Oh dear! Oh dear! I shall be late!' (when she thought it over afterwards, it occurred to her that she ought to have wondered at this, but at the time it all seemed quite natural); but when the Rabbit actually took a watch out of its waistcoat- pocket, and looked at it, and then hurried on, Alice started to her feet, for it flashed across her mind that she had never before seen a rabbit with either a waistcoat-pocket, or a watch to take out of it, and burning with curiosity, she ran across the field after it, and fortunately was just in time to see it pop down a large rabbit-hole under the hedge."
                ],
                "Chapter 2 - The Pool of Tears": [
                    "`Curiouser and curiouser!' cried Alice (she was so much surprised, that for the moment she quite forgot how to speak good English); `now I'm opening out like the largest telescope that ever was! Good-bye, feet!' (for when she looked down at her feet, they seemed to be almost out of sight, they were getting so far off). `Oh, my poor little feet, I wonder who will put on your shoes and stockings for you now, dears? I'm sure _I_ shan't be able! I shall be a great deal too far off to trouble myself about you: you must manage the best way you can; --but I must be kind to them,' thought Alice, `or perhaps they won't walk the way I want to go! Let me see: I'll give them a new pair of boots every Christmas.'",
                    "And she went on planning to herself how she would manage it. `They must go by the carrier,' she thought; `and how funny it'll seem, sending presents to one's own feet! And how odd the directions will look!"
                ]
            }
        },
        'id22222': {
            'book2': {
                "chapter1": [
                    "text from book 2 chapter 1 page 1",
                    "text from book 2 chapter 1 page 2",
                    "text from book 2 chapter 1 page 3"
                ],
                "chapter2": [
                    "text from book 2 chapter 2 page 1",
                    "text from book 2 chapter 2 page 2"
                ],
                "chapter3": [
                    "text from book 2 chapter 3 page 1",
                    "text from book 2 chapter 3 page 2",
                    "text from book 2 chapter 3 page 3"
                ],
                "chapter4": [
                    "text from book 2 chapter 4 page 1"
                ]
            }
        },
        'id33333': {
            'book3': {
                "chapter1": [
                    "text from book 3 chapter 1 page 1",
                    "text from book 3 chapter 1 page 2",
                    "text from book 3 chapter 1 page 3"
                ]
            }
        },
        'id44444': {
            'book4': {
                "chapter1": [
                    "text from book 4 chapter 1 page 1",
                    "text from book 4 chapter 1 page 2",
                    "text from book 4 chapter 1 page 3"
                ],
                "chapter2": [
                    "text from book 4 chapter 2 page 1",
                    "text from book 4 chapter 2 page 2"
                ],
                "chapter3": [
                    "text from book 4 chapter 3 page 1",
                    "text from book 4 chapter 3 page 2",
                    "text from book 4 chapter 3 page 3"
                ],
                "chapter4": [
                    "text from book 4 chapter 4 page 1"
                ],
                "chapter5": [
                    "text from book 4 chapter 5 page 1",
                    "text from book 4 chapter 5 page 2",
                    "text from book 4 chapter 5 page 3",
                    "text from book 4 chapter 5 page 4",
                    "text from book 4 chapter 5 page 5"
                ]
            }
        },
    };


    // Make function to add breadcrumb
    var makeBreadcrumb = function() {
        var div = document.createElement('div');
        div.setAttribute('class', 'fa fa-caret-left caret-back');
        div.classList.add('hide');
        div.classList.add('breadcrumb-icon');

        return div; //returns product of div element
    };

    // Make a book title div
    var makeTitle = function(titleText) {
        var titleDiv = document.createElement('div'); // create a div to store book titles
        titleDiv.setAttribute('class', 'book-title list');
        // titleDiv.textContent = title.slice(0,2) + "â€¦"; // for adding ellipses
        titleDiv.textContent = titleText; // put whatever keys you got from 'title' into the div created

        var myBreadcrumb = makeBreadcrumb(); //make variable to run function that makes breadrumb
        titleDiv.insertBefore(myBreadcrumb, titleDiv.firstChild); //insert breadcrumb vefore title div

        return titleDiv; //returns product of div
    };


    // Make pages of text
    var makeTextElement = function(text) {
        var textElement = document.createElement('div');
        textElement.setAttribute('class', 'book-text list');
        textElement.textContent = text;

        return textElement;
    };

    // Make list of pages of text
    var makeTextList = function() {
        var textList = document.createElement('div');
        textList.setAttribute('class', 'text-list');

        return textList;
    };

    // Make chapter titles
    var makeChapterTitle = function(text) {
        var chapterTitle = document.createElement('div');
        chapterTitle.setAttribute('class', 'chapter-title list');
        chapterTitle.textContent = text;

        return chapterTitle;
    };

    // Make list of chapter titles
    var makeChapterItem = function(chapterTitle) {

        var chapterItem = document.createElement('li');
        chapterItem.setAttribute('class', 'chapter');
        chapterItem.appendChild(chapterTitle);


        return chapterItem;
    };

    // Make <ul> that holds chapters
    var makeChapter = function(title) {
        var myChapterTitle = makeChapterTitle(chapter);
        var myChapterItem = makeChapterItem(myChapterTitle);
        return myChapterItem;
    };


    // make book list
    var makeBook = function(title) {
        var bookItem = document.createElement('li'); //create a list
        bookItem.setAttribute('class', 'book'); // set class

        var myTitleDiv = makeTitle(title); // variable that runs 'title' function on function above that makes book titles
        bookItem.appendChild(myTitleDiv); // get the child of bookItem 'titleDiv'
        document.getElementById("Books").appendChild(bookItem); //put the list created into div with ID "books"

        return bookItem;
    };

    for (var key in bookData) { //Get the keys
        for (var title in bookData[key]) { 
            var bookItem = makeBook(title); // for the keys in book data make an element called 'title'
            var chapterList = document.createElement('ul'); //make a list called 'chapterList' 
            bookItem.appendChild(chapterList); //get child 'chapterList' and put book list in it.

            for (var chapter in bookData[key][title]) { 
                var myChapter = makeChapter(chapter); //for the titles in bookData make an element called 'chapter'
                chapterList.appendChild(myChapter); //get child of myChapter and put chapter list in it

                var myTextList = makeTextList(); //run function makeTextList above that creates divs to hold text pages
                myChapter.appendChild(myTextList); //Put it inside of its chapter

                var chapterTexts = bookData[key][title][chapter]; //for the chapters in bookData make an element called 'text'
                chapterTexts.forEach(function(text) { //each time there is chapter text run a function
                    var myTextElement = makeTextElement(text); //the function makes an element called 'text'
                    myTextList.appendChild(myTextElement); //put the individual text inside of text list created before
                });
            };
        };

    };

    // Make arrays from specific classes

    var books = Array.from(document.querySelectorAll('.book'));
    var chapters = Array.from(document.querySelectorAll('.chapter'));
    var bookTexts = Array.from(document.querySelectorAll('.book-text'));

    // Adds opacity
    var addOpacity = function(unSelected) {
        unSelected.classList.add('opacity');
        console.log (addOpacity)
    };

    // Function to close book chapters by removing class
    var deactivateBookChapters = function(myBookChapters) {
        myBookChapters.classList.remove('selected');
    };

    // Make function to toggle Books open and close called "toggleBook"
    var toggleBook = function(myBook) {
        myBook.classList.toggle('selected');
        if (!myBook.classList.contains('selected')) { //if a book does NOT contain .selected
            var myChapters = Array.from(myBook.querySelectorAll('.chapter, .book-text')); //Get all elements with .chapter
            myChapters.forEach(deactivateBookChapters); // Run function to close all chapters in book
            myBook(addOpacity)
        }
    };


    //Runs "toggleBook" function made above every time a book title is selected
    books.forEach(function(myBook) {
        myBook.addEventListener("click", function() {
            toggleBook(myBook);
            books.forEach(function(otherBook) { // Go through each book
                if (otherBook != myBook) { //if book does not equal the book I selected...
                    deactivateBook(otherBook)//run function "deactivateBook" on books that aren't selected
                }
            })
        });
    });

    // Function to close book titles by removing class
    var deactivateBook = function(myBook) {
        myBook.classList.remove('selected')
    }

    // Function to close book text by removing class
    var deactivateBookText = function(myBookText) {
        myBookText.classList.remove('selected');
    };



    // Function to toggle chapters by removing class. Also stops pages from staying open after its chapter is closed.
    var toggleChapter = function(myChapter) {
        myChapter.classList.toggle('selected');
        if (!myChapter.classList.contains('selected')) { //if a chapter does NOT contain .selected
            var myPages = Array.from(myChapter.querySelectorAll('.book-text')); //Get all elements with .book-text
            myPages.forEach(deactivateBookText); // Run function to hide book text on each element with .book-text
        }
    };

    // Toggle chapters
    chapters.forEach(function(myChapter) { // for every element with .chapter run a function
        myChapter.addEventListener("click", function(myEvent) {
            myEvent.stopPropagation(); //Stop event from bubbling up to books container
            toggleChapter(myChapter); // run "toggleChapter" on event listener
            chapters.forEach(function(otherChapter) { // Go through each chapter
                if (otherChapter != myChapter) { //if chapter does not equal the chapter I selected...
                    deactivateBookChapters(otherChapter)//run function "deactivateBookChapters" on chapters that aren't selected
                }
            })
        });
    });

    // Function to toggle book text by removing class
    var toggleBookText = function(myBookText) {
        myBookText.classList.toggle('selected');
    };

    // Toggle individual pages by running "toggleBookText"
    bookTexts.forEach(function(myBookText) { // for every element with .book-text run a function
        myBookText.addEventListener("click", function(myEvent) { //give this function a click event
            myEvent.stopPropagation(); // stop this event from affecting parent element
            toggleBookText(myBookText); // run the toggling function on every element with .book-text
            bookTexts.forEach(function(otherText) { // Go through each book
                if (otherText != myBookText) { //if book does not equal the book I selected...
                    deactivateBookText(otherText)//run function "deactivateBook" on books that aren't selected
                }
            })
        });
    });




    // Production steps of ECMA-262, Edition 6, 22.1.2.1
// Reference: https://people.mozilla.org/~jorendorff/es6-draft.html#sec-array.from
if (!Array.from) {
  Array.from = (function () {
    var toStr = Object.prototype.toString;
    var isCallable = function (fn) {
      return typeof fn === 'function' || toStr.call(fn) === '[object Function]';
    };
    var toInteger = function (value) {
      var number = Number(value);
      if (isNaN(number)) { return 0; }
      if (number === 0 || !isFinite(number)) { return number; }
      return (number > 0 ? 1 : -1) * Math.floor(Math.abs(number));
    };
    var maxSafeInteger = Math.pow(2, 53) - 1;
    var toLength = function (value) {
      var len = toInteger(value);
      return Math.min(Math.max(len, 0), maxSafeInteger);
    };

    // The length property of the from method is 1.
    return function from(arrayLike/*, mapFn, thisArg */) {
      // 1. Let C be the this value.
      var C = this;

      // 2. Let items be ToObject(arrayLike).
      var items = Object(arrayLike);

      // 3. ReturnIfAbrupt(items).
      if (arrayLike == null) {
        throw new TypeError("Array.from requires an array-like object - not null or undefined");
      }

      // 4. If mapfn is undefined, then let mapping be false.
      var mapFn = arguments.length > 1 ? arguments[1] : void undefined;
      var T;
      if (typeof mapFn !== 'undefined') {
        // 5. else
        // 5. a If IsCallable(mapfn) is false, throw a TypeError exception.
        if (!isCallable(mapFn)) {
          throw new TypeError('Array.from: when provided, the second argument must be a function');
        }

        // 5. b. If thisArg was supplied, let T be thisArg; else let T be undefined.
        if (arguments.length > 2) {
          T = arguments[2];
        }
      }

      // 10. Let lenValue be Get(items, "length").
      // 11. Let len be ToLength(lenValue).
      var len = toLength(items.length);

      // 13. If IsConstructor(C) is true, then
      // 13. a. Let A be the result of calling the [[Construct]] internal method of C with an argument list containing the single item len.
      // 14. a. Else, Let A be ArrayCreate(len).
      var A = isCallable(C) ? Object(new C(len)) : new Array(len);

      // 16. Let k be 0.
      var k = 0;
      // 17. Repeat, while k < lenâ€¦ (also steps a - h)
      var kValue;
      while (k < len) {
        kValue = items[k];
        if (mapFn) {
          A[k] = typeof T === 'undefined' ? mapFn(kValue, k) : mapFn.call(T, kValue, k);
        } else {
          A[k] = kValue;
        }
        k += 1;
      }
      // 18. Let putStatus be Put(A, "length", len, true).
      A.length = len;
      // 20. Return A.
      return A;
    };
  }());
}    
    </script>
</body>

</html>